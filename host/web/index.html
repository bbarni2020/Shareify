<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shareify</title>
    <link rel="stylesheet" href="web/index.css">
    <link rel="shortcut icon" href="web/assets/icon.ico" type="image/x-icon">
</head>
<body>
    <div class="container">
        <div class="app_icons" style="background: url(web/assets/finder.png) lightgray 50% / cover no-repeat;" onclick="finder_open()">
            <div class="indicator" id="finder-indicator"></div>
        </div>
        <div class="app_icons" style="background: url(web/assets/user.png) lightgray 50% / cover no-repeat;" onclick="users_open()">
            <div class="indicator" id="users-indicator"></div>
        </div>
        <div class="app_icons" style="background: url(web/assets/nas.png) lightgray 50% / cover no-repeat;" onclick="nas_open()">
            <div class="indicator" id="nas-indicator"></div>
        </div>
        <div class="app_icons" style="background: url(web/assets/settings.png) lightgray 50% / cover no-repeat;" onclick="settings_open()">
            <div class="indicator" id="settings-indicator"></div>
        </div>
    </div>
    <div class="clock_div">
        <div id="clock" class="clock_text"></div>
        <div class="clock_img"></div>
    </div>
    <div class="leave"></div>
    <div class="window" id="finder-window">
        <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 22 22" fill="none" class="exit_btn">
            <g filter="url(#filter0_i_19_3)">
                <circle cx="11" cy="11" r="11" fill="#DC2626"/>
            </g>
        </svg>
        <div class="window_title">Finder</div>
        <div class="resize_handle"></div>
    </div>
    <div class="window" id="users-window">
        <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 22 22" fill="none" class="exit_btn">
            <g filter="url(#filter0_i_19_3)">
                <circle cx="11" cy="11" r="11" fill="#DC2626"/>
            </g>
        </svg>
        <div class="window_title">Users</div>
        <div class="resize_handle"></div>
    </div>
    <div class="window" id="nas-window">
        <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 22 22" fill="none" class="exit_btn">
            <g filter="url(#filter0_i_19_3)">
                <circle cx="11" cy="11" r="11" fill="#DC2626"/>
            </g>
        </svg>
        <div class="window_title">NAS</div>
        <div class="resize_handle"></div>
    </div>
    <div class="window" id="settings-window">
        <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 22 22" fill="none" class="exit_btn">
            <g filter="url(#filter0_i_19_3)">
                <circle cx="11" cy="11" r="11" fill="#DC2626"/>
            </g>
        </svg>
        <div class="window_title">Settings</div>
        <div class="sections_container">
            <div class="section">
                <div class="section_title" onclick="toggleSection(this)">
                    <p>Personal settings</p>
                    <div class="dropdown_icon"></div>
                </div>
                <div class="section_content">
                    <p style="font-size: 17px;">Here you can edit the server's general settings.</p>
                    <div class="horizontal-align">
                        <label for="name">Preferred name:</label>
                        <input type="text" name="name" id="name" class="textbox">
                    </div>
                    <div class="horizontal-align">
                        <label for="username">Username:</label>
                        <input type="text" name="username" id="username" class="textbox">
                    </div>
                    <div class="horizontal-align">
                        <label for="password_web">Password:</label>
                        <input type="text" name="password_web" id="password_web" class="textbox">
                    </div>
                    <div class="horizontal-align" style="margin-top: 10px;">
                        <div style="width: 100%;"></div>
                        <div id="personal_saved">Saved</div>
                        <div class="accept_btn" id="personal_accept"><img src="web/assets/pipe.png" alt="pipe" class="centered-img"></div>
                    </div>
                    <div style="margin-top: 18px; margin-bottom: 8px; font-size: 17px;">Choose background:</div>
                    <div class="background-selector" id="background-selector">
                        <div class="background-thumb selected" data-bg="assets/backgrounds/back1.png" style="background-image: url('web/assets/backgrounds/back1.png');"></div>
                        <div class="background-thumb" data-bg="assets/backgrounds/back2.png" style="background-image: url('web/assets/backgrounds/back2.png');"></div>
                        <div class="background-thumb" data-bg="assets/backgrounds/back3.png" style="background-image: url('web/assets/backgrounds/back3.png');"></div>
                        <div class="background-thumb" data-bg="assets/backgrounds/back4.png" style="background-image: url('web/assets/backgrounds/back4.png');"></div>
                        <div class="background-thumb" data-bg="assets/backgrounds/back5.png" style="background-image: url('web/assets/backgrounds/back5.png');"></div>
                        <div class="background-thumb" data-bg="assets/backgrounds/back6.png" style="background-image: url('web/assets/backgrounds/back6.png');"></div>
                        <div class="background-thumb" data-bg="assets/backgrounds/back7.png" style="background-image: url('web/assets/backgrounds/back7.png');"></div>
                        <div class="background-thumb" data-bg="assets/backgrounds/back8.png" style="background-image: url('web/assets/backgrounds/back8.png');"></div>
                        <div class="background-thumb" data-bg="assets/backgrounds/back9.png" style="background-image: url('web/assets/backgrounds/back9.png');"></div>
                        <div class="background-thumb" data-bg="assets/backgrounds/back10.png" style="background-image: url('web/assets/backgrounds/back10.png');"></div>
                        <div class="background-thumb" data-bg="assets/backgrounds/back11.png" style="background-image: url('web/assets/backgrounds/back11.png');"></div>
                        <div class="background-thumb" data-bg="assets/backgrounds/back12.png" style="background-image: url('web/assets/backgrounds/back12.png');"></div>
                        <div class="background-thumb" data-bg="assets/backgrounds/back13.png" style="background-image: url('web/assets/backgrounds/back13.png');"></div>
                        <div class="background-thumb" data-bg="assets/backgrounds/back14.png" style="background-image: url('web/assets/backgrounds/back14.png');"></div>
                    </div>
                </div>
            </div>
            <div class="section">
                <div class="section_title" onclick="toggleSection(this)">
                    <p>Server settings</p>
                    <div class="dropdown_icon"></div>
                </div>
                <div class="section_content">
                    <p style="font-size: 17px;">Here you can edit the server's general settings.</p>
                    <div class="horizontal-align">
                        <label for="path">Default path:</label>
                        <input type="text" name="path" id="path" class="textbox">
                    </div>
                    <div class="horizontal-align">
                        <label for="host">Host ip:</label>
                        <input type="text" name="host" id="host" class="textbox">
                    </div>
                    <div class="horizontal-align">
                        <label for="port">Host port:</label>
                        <input type="number" name="port" id="port" class="textbox">
                    </div>
                    <div class="horizontal-align">
                        <label for="ftp-server">FTP server:</label>
                        <select id="ftp-server">
                            <option>On</option>
                            <option>Off</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="section">
                <div class="section_title" onclick="toggleSection(this)">
                    <p>FTP settings</p>
                    <div class="dropdown_icon"></div>
                </div>
                <div class="section_content">
                    <p>Section content goes here...</p>
                    <input type="text" name="random" id="random" class="textbox">
                </div>
            </div>
        </div>
        <div class="resize_handle"></div>
    </div>
    <div class="icon"></div>
</body>
<script>
    const windows = document.querySelectorAll('.window');
    let zIndexCounter = 1;
    let isDragging = false;
    let isResizing = false;
    let offsetX, offsetY, startWidth, startHeight;
    let activeDragWindow = null;

    function getTopmostWindow() {
        let topWindow = null;
        let topZ = -Infinity;
        windows.forEach(w => {
            const z = parseInt(w.style.zIndex) || 0;
            if (w.classList.contains('show') && z > topZ) {
                topZ = z;
                topWindow = w;
            }
        });
        return topWindow;
    }

    windows.forEach((windowElement) => {
        const exitButton = windowElement.querySelector('.exit_btn');
        const resizeHandle = windowElement.querySelector('.resize_handle');

        exitButton.addEventListener('click', () => {
            const windowId = windowElement.id;
            const indicatorId = `${windowId.split('-')[0]}-indicator`;
            windowElement.classList.add('hide');
            windowElement.classList.remove('show');
            updateIndicator(windowId, indicatorId);
        });

        windowElement.addEventListener('mousedown', (e) => {
            if (e.target === resizeHandle || e.target === exitButton) return;
            bringToFront(windowElement);
            if (getTopmostWindow() !== windowElement) return;
            isDragging = true;
            activeDragWindow = windowElement;
            offsetX = e.clientX - windowElement.offsetLeft;
            offsetY = e.clientY - windowElement.offsetTop;
            windowElement.style.cursor = 'grabbing';
        });

        resizeHandle.addEventListener('mousedown', (e) => {
            isResizing = true;
            offsetX = e.clientX;
            offsetY = e.clientY;
            startWidth = windowElement.offsetWidth;
            startHeight = windowElement.offsetHeight;
            e.stopPropagation();
            bringToFront(windowElement);
        });
    });

    document.addEventListener('mousemove', (e) => {
        if (isDragging && activeDragWindow) {
            activeDragWindow.style.left = `${e.clientX - offsetX}px`;
            activeDragWindow.style.top = `${e.clientY - offsetY}px`;
        } else if (isResizing) {
            const activeWindow = document.querySelector('.window.show');
            if (activeWindow) {
                const newWidth = Math.max(startWidth + (e.clientX - offsetX), 300);
                const newHeight = Math.max(startHeight + (e.clientY - offsetY), 200);
                activeWindow.style.width = `${newWidth}px`;
                activeWindow.style.height = `${newHeight}px`;
            }
        }
    });

    document.addEventListener('mouseup', () => {
        isDragging = false;
        isResizing = false;
        activeDragWindow = null;
        document.body.style.cursor = 'default';
    });

    function bringToFront(windowElement) {
        zIndexCounter++;
        windowElement.style.zIndex = zIndexCounter;
    }

    function updateIndicator(windowId, indicatorId) {
        const windowElement = document.getElementById(windowId);
        const indicatorElement = document.getElementById(indicatorId);
        if (windowElement.classList.contains('show')) {
            indicatorElement.classList.add('active');
        } else {
            indicatorElement.classList.remove('active');
        }
    }

    function finder_open() {
        const windowElement = document.getElementById('finder-window');
        if (windowElement) {
            windowElement.classList.add('show');
            windowElement.classList.remove('hide');
            bringToFront(windowElement);
            updateIndicator('finder-window', 'finder-indicator');
        }
    }

    function users_open() {
        const windowElement = document.getElementById('users-window');
        if (windowElement) {
            windowElement.classList.add('show');
            windowElement.classList.remove('hide');
            bringToFront(windowElement);
            updateIndicator('users-window', 'users-indicator');
        }
    }

    function nas_open() {
        const windowElement = document.getElementById('nas-window');
        if (windowElement) {
            windowElement.classList.add('show');
            windowElement.classList.remove('hide');
            bringToFront(windowElement);
            updateIndicator('nas-window', 'nas-indicator');
        }
    }

    function settings_open() {
        const windowElement = document.getElementById('settings-window');
        if (windowElement) {
            windowElement.classList.add('show');
            windowElement.classList.remove('hide');
            bringToFront(windowElement);
            updateIndicator('settings-window', 'settings-indicator');
        }
    }

    document.querySelectorAll('.section_title').forEach((titleElement) => {
        titleElement.addEventListener('click', () => {
            const section = titleElement.parentElement;
            section.classList.toggle('expanded');
        });
    });

    document.querySelectorAll('.custom-dropdown').forEach(dropdown => {
        const selected = dropdown.querySelector('.dropdown-selected');
        const list = dropdown.querySelector('.dropdown-list');
        const options = dropdown.querySelectorAll('.dropdown-option');
        const selectedText = dropdown.querySelector('span');

        selected.addEventListener('click', (e) => {
            e.stopPropagation();
            document.querySelectorAll('.custom-dropdown.open').forEach(d => {
                if (d !== dropdown) d.classList.remove('open');
            });
            dropdown.classList.toggle('open');
        });

        options.forEach(option => {
            option.addEventListener('click', (e) => {
                options.forEach(o => o.classList.remove('active'));
                option.classList.add('active');
                selectedText.textContent = option.textContent;
                dropdown.classList.remove('open');
            });
        });

        document.addEventListener('click', (e) => {
            if (!dropdown.contains(e.target)) {
                dropdown.classList.remove('open');
            }
        });

        dropdown.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                dropdown.classList.toggle('open');
                e.preventDefault();
            }
            if (e.key === 'Escape') {
                dropdown.classList.remove('open');
            }
        });
    });

    document.documentElement.style.transition = "background-image 0.4s ease";

    let bgFadeOverlay = document.createElement('div');
    bgFadeOverlay.id = 'bg-fade-overlay';
    bgFadeOverlay.style.position = 'fixed';
    bgFadeOverlay.style.top = 0;
    bgFadeOverlay.style.left = 0;
    bgFadeOverlay.style.width = '100vw';
    bgFadeOverlay.style.height = '100vh';
    bgFadeOverlay.style.zIndex = '-1';
    bgFadeOverlay.style.pointerEvents = 'none';
    bgFadeOverlay.style.opacity = '0';
    bgFadeOverlay.style.transition = 'opacity 0.4s ease';
    bgFadeOverlay.style.backgroundSize = 'cover';
    bgFadeOverlay.style.backgroundPosition = 'center center';
    bgFadeOverlay.style.backgroundRepeat = 'no-repeat';
    document.body.prepend(bgFadeOverlay);

    document.querySelectorAll('.background-thumb').forEach(thumb => {
        thumb.addEventListener('click', function() {
            if (this.classList.contains('selected')) return;
            document.querySelectorAll('.background-thumb').forEach(t => t.classList.remove('selected'));
            this.classList.add('selected');

            const html = document.documentElement;
            let bgPath = this.dataset.bg;
            if (!bgPath.startsWith('web/')) {
                bgPath = 'web/' + bgPath;
            }
            const newBg = `url('${bgPath}')`;

            bgFadeOverlay.style.backgroundImage = newBg;
            bgFadeOverlay.style.opacity = '0';
            void bgFadeOverlay.offsetWidth;
            bgFadeOverlay.style.opacity = '1';

            setTimeout(() => {
                html.style.backgroundImage = newBg;
                bgFadeOverlay.style.opacity = '0';
            }, 400);
        });
    });

    function updateClock() {
        const clock = document.getElementById('clock');
        if (!clock) return;
        const now = new Date();
        const hours = now.getHours().toString().padStart(2, '0');
        const minutes = now.getMinutes().toString().padStart(2, '0');
        clock.textContent = `${hours}:${minutes}`;
    }
    updateClock();
    setInterval(updateClock, 1000);

    document.querySelectorAll('.accept_btn').forEach(btn => {
        btn.addEventListener('click', function () {
            this.classList.remove('active');
            void this.offsetWidth;
            this.classList.add('active');
            setTimeout(() => {
                this.classList.remove('active');
            }, 450);

            if (this.id === 'personal_accept') {
                const savedDiv = document.getElementById('personal_saved');
                if (savedDiv) {
                    savedDiv.classList.add('visible');
                    clearTimeout(savedDiv._hideTimeout);
                    savedDiv._hideTimeout = setTimeout(() => {
                        savedDiv.classList.remove('visible');
                    }, 5000);
                }
            }
        });
    });
</script>
</html>